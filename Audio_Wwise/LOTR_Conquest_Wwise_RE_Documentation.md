# LOTR Conquest Wwise Audio Reverse Engineering Project

## Table of Contents

1. [Project Overview](#project-overview)
2. [Technical Foundation](#technical-foundation)
3. [Hash Cracking Campaign](#hash-cracking-campaign)
4. [Implementation Details](#implementation-details)
5. [Data Sources and Extraction](#data-sources-and-extraction)
6. [What Has Been Done vs. Not Done](#what-has-been-done-vs-not-done)
7. [Audio Modding Feasibility](#audio-modding-feasibility)
8. [Lessons Learned](#lessons-learned)
9. [Appendices](#appendices)

---

## Project Overview

### Initial Goals and Motivations

The LOTR Conquest Wwise Audio Reverse Engineering project was initiated to:

1. **Understand the game's audio system** - LOTR Conquest (2009) uses Audiokinetic Wwise v34 for all audio playback
2. **Create a debug overlay** - Real-time visualization of audio events during gameplay
3. **Enable audio modding** - Allow replacement of game audio with custom files
4. **Document the audio architecture** - Create a reference for future modding efforts

### High-Level Summary

| Category | Status | Details |
|----------|--------|---------|
| Wwise Version Identification |  Complete | v34 (circa 2008-2009) |
| FNV-1 Hash Algorithm RE |  Complete | Offset: 2166136261, Prime: 16777619 |
| Event Mapping |  47% Named | 1,325 of 2,817 events have semantic names |
| DebugOverlay DLL |  Functional | Hooks PostEvent, GetIDFromString, SetSwitch, SetState |
| Audio Capture |  Working | Real-time event logging with bank tracking |
| Hash Cracking |  Ongoing | ~15.2 billion patterns tested |
| Audio Modding |  Planned | Design complete, implementation pending |

### Timeline of Major Milestones

| Date | Milestone |
|------|-----------|
| 2024-12-01 | Project inception, initial Wwise version identification |
| 2024-12-03 | First successful PostEvent hook |
| 2024-12-05 | TXTP parsing pipeline established |
| 2024-12-06 | FNV-1 hash algorithm confirmed |
| 2024-12-07 | First batch of 500+ events cracked via dictionary attack |
| 2024-12-08 | DebugOverlay v1.0 with audio panel |
| 2024-12-09 | 1,325 events cracked (47%), 8-char brute force running |

---

## Technical Foundation

### Wwise Version Identification

**Version**: Wwise v34 (2008-2009 era)

**Evidence**:
- BNK file header magic: `BKHD` with version field = 34
- HIRC chunk structure matches v34 specification
- CAkEvent object type = 4 (consistent with v34)

**Implications**:
- Modern Wwise tools (2020+) cannot parse these files
- Custom parsers required for BNK/WEM extraction
- No official documentation available for this version

### FNV-1 Hash Algorithm

Wwise uses FNV-1 (Fowler-Noll-Vo) hashing for event name lookups:

```
Offset Basis: 2166136261 (0x811C9DC5)
Prime:        16777619   (0x01000193)
```

**Algorithm** (from `GetIDFromString` at `0x00560190`):

```c
DWORD fnv1_hash(const char* str) {
    DWORD hash = 2166136261u;
    while (*str) {
        char c = tolower(*str++);
        hash = (hash * 16777619u) ^ (BYTE)c;
    }
    return hash;
}
```

**Key Properties**:
- Case-insensitive (lowercase conversion before hashing)
- 32-bit output
- Non-reversible (one-way function)
- Collision-resistant but not collision-free

### File Formats

#### BNK (Soundbank) Structure

```
+0x00: BKHD chunk (Bank Header)
       - Magic: "BKHD" (4 bytes)
       - Size: u32
       - Version: u32 (34 for this game)
       - Bank ID: u32

+0xNN: STID chunk (String Table ID)
       - Magic: "STID" (4 bytes)
       - Size: u32
       - Type: u32 (1)
       - Count: u32
       - Entries: [bank_id: u32, str_len: u8, name: chars]

+0xNN: HIRC chunk (Hierarchy)
       - Magic: "HIRC" (4 bytes)
       - Size: u32
       - Object Count: u32
       - Objects: [type: u32, size: u32, id: u32, data...]
```

**HIRC Object Types**:
| Type | Name | Description |
|------|------|-------------|
| 1 | CAkState | State container |
| 2 | CAkSound | Audio file reference |
| 3 | CAkAction | Playback action |
| 4 | CAkEvent | Named event (hash ID) |
| 5 | CAkRanSeqCntr | Random/Sequence container |
| 6 | CAkSwitchCntr | Switch container |
| 7 | CAkActorMixer | Actor mixer |
| 8 | CAkBus | Audio bus |

#### WEM (Wwise Encoded Media)

- Container format for audio data
- Typically Vorbis-encoded (OGG variant)
- Can be converted to WAV/OGG using vgmstream

#### TXTP (Text Playback)

Generated by wwiser tool, defines event playback chains:

```
# Example: HeroSauron-0095-event {r}.txtp
CAkEvent[0] 1234567890
 CAkActionPlay[0] 2345678901
  CAkRanSeqCntr[0] 3456789012
   CAkSound[0] 4567890123 {s}
    wem/4567890123.wem
```

### Memory Addresses (ConquestLLC.exe)

| Function | Address | Signature |
|----------|---------|-----------|
| PostEventByID | 0x00561360 | `DWORD __cdecl(DWORD eventId, DWORD gameObjId)` |
| PostEventByName | 0x00560F90 | `DWORD __cdecl(const char* name, DWORD gameObjId)` |
| GetIDFromString | 0x00560190 | `DWORD __cdecl(const char* str)` |
| SetSwitchByID | 0x0055EEF0 | `void __cdecl(DWORD groupId, DWORD valueId, DWORD gameObjId)` |
| SetStateByID | 0x0055FFD0 | `void __cdecl(DWORD groupId, DWORD valueId)` |
| StopAll | 0x0055FCA0 | `void __cdecl(DWORD gameObjId)` |
| SetPosition | 0x0055ED30 | `void __cdecl(DWORD gameObjId, float x, y, z, ...)` |
| SetListenerPosition | 0x0055EDC0 | `void __cdecl(float x, y, z, ...)` |
| AudioEnabled | 0x00A3E851 | `BYTE` (1 = enabled) |
| View Matrix | 0x009CD5E8 | `pbl::Matrix4x4` |
| Projection Matrix | 0x009D85B0 | `matrix4x4` |

---

## Hash Cracking Campaign

### Overview

Since Wwise event names are stored as FNV-1 hashes (not plaintext), recovering the original names requires either:
1. **Dictionary attacks** - Testing known/guessed names
2. **Brute force** - Testing all possible character combinations
3. **Runtime capture** - Hooking `GetIDFromString` to log names as the game uses them

### Tools Developed

All tools located in `wwiseRE/HashCracking/`:

| Tool | Language | Performance | Description |
|------|----------|-------------|-------------|
| `brute_fnv1.c` | C | ~200M hashes/sec | Optimized single-threaded brute forcer |
| `multicore_cracker.py` | Python | ~50M hashes/sec | Multi-process Python cracker |
| `brute_force_cuda.py` | Python/CUDA | ~500M hashes/sec | GPU-accelerated (RTX 5070) |
| `advanced_cracker.py` | Python | ~10M hashes/sec | Dictionary + pattern hybrid |
| `build_event_dictionary.py` | Python | N/A | Extracts names from level.json files |

### Attack Methodologies

#### 1. Dictionary Attack

**Source**: `lotr_dictionary.txt` - LOTR-specific word list

**Patterns tested**:
- Single words: `attack`, `death`, `swing`, etc.
- Prefixed: `play_attack`, `stop_death`, `set_swing`
- Hero-specific: `gandalf_attack`, `sauron_death`
- Level-specific: `moria_intro`, `helms_rain`

**Results**: 84 direct matches (see `dictionary_matches.txt`)

#### 2. Pattern-Based Attack

**Discovered naming conventions**:

| Pattern | Example | Count |
|---------|---------|-------|
| `play_*` | `play_music`, `play_ability` | 150+ |
| `stop_*` | `stop_music`, `stop_cloak` | 80+ |
| `*_death` | `gandalf_death`, `troll_death` | 40+ |
| `*_attack` | `balrog_attack`, `orc_attack` | 30+ |
| `*_sa1/2/3` | `gandalf_sa1`, `frodo_sa2` | 45+ |
| `*_intro` | `moria_intro`, `helms_intro` | 20+ |
| `amb_*` | `amb_battle`, `amb_fire_big` | 60+ |
| `vo_*` | `vo_cks_01`, `vo_cks_02` | 100+ |

#### 3. Brute Force Attack

**Character set**: `abcdefghijklmnopqrstuvwxyz0123456789_` (37 chars)

| Length | Total Patterns | Time @ 200M/s | Status |
|--------|----------------|---------------|--------|
| 5 | 69,343,957 | 0.3 sec |  Complete |
| 6 | 2,565,726,409 | 13 sec |  Complete |
| 7 | 94,931,877,133 | 8 min |  Complete |
| 8 | 3,512,479,453,921 | 4.9 hours | 12.4% |
| 9 | 129,961,739,795,077 | 7.5 days | Not started |

5-char brute force	69,343,957 | Complete
6-char brute force	2,565,726,409	| Complete
7-char brute force	94,931,877,133	| Complete
8-char brute force (12.4%)	435,547,411,886	| Partial
Dictionary attacks	~4,000,000	| Complete
Targeted hero patterns	~42,000	| Complete
Bank-specific patterns	~1,000,000	| Complete
2-word combinations	375,769	| Complete
3-word combinations	7,515,380	| Complete
4-word combinations	460,692,794	| Complete
Level JSON mining	~25,000	| Complete

# Grand Total: ~533 billion patterns
# Or more precisely: ~533,588,009,328 patterns tested*
# Half a trillion hashes computed looking for 21 stubborn event names.

# The 7-char brute force alone found 444 hash collisions (gibberish strings that happen to hash to target values) but 0  real event names - demonstrating how unlikely it is that real names are ≤7 characters.

# 7-char results**: 94.9 billion patterns, 444 hash collisions, 0 real matches

#### 4. Level JSON Mining

**Source**: `LUA/shell/sub_blocks2/*.json` (level definition files)

**Discovery**: Level files contain unhashed event names in `VOSoundEvents` arrays:
```json
"VOSoundEvents": ["VO_TRN_KeepFighting_remind_02", ...]
```

**Key insight**: Game code adds `play_` prefix when calling PostEvent:
- JSON: `VO_TRN_KeepFighting_remind_02`
- Runtime: `play_vo_trn_keepfighting_remind_02`
- Hash: `0xEA28F201`

### Cracking Statistics

| Metric | Value |
|--------|-------|
| Total events in game | 2,817 |
| Events with semantic names | 1,325 (47.0%) |
| Events with TXTP names only | 1,457 (51.7%) |
| Completely unknown events | 35 (1.2%) |
| Total patterns tested | ~15.2 billion |
| Overall hit rate | 1 in ~11.7 million |

### Stubborn Remaining Events

18 priority events have resisted all attacks:

| Bank | Count | Hashes |
|------|-------|--------|
| HeroIsildur | 3 | 0x84405926, 0x5BBF9654, 0x2EB326D8 |
| HeroLegolas | 2 | 0xD9A5464C, 0x214CA366 |
| SFXBatteringRam | 2 | 0x8DCE21D5, 0x79D92FB7 |
| SFXCatapult | 2 | 0x0CCA70A9, 0x4C480561 |
| HeroGimli | 1 | 0xFF74FDE5 |
| HeroSaruman | 1 | 0xA6D835D7 |
| HeroMouth | 1 | 0xEF688F80 |
| SFXBalrog | 1 | 0xD1E41CDA |
| SFXOliphant | 1 | 0xDF91450F |
| SFXSiegeTower | 1 | 0xDCD9D5DD |
| Creatures | 1 | 0xDD7978E6 |
| Level_Isengard | 1 | 0x94BDA720 |
| Ambience | 1 | 0xE234322F |

---

## Implementation Details

### DebugOverlay DLL Architecture

**Location**: `DebugOverlay/src/`

**Components**:

| File | Lines | Purpose |
|------|-------|---------|
| `dllmain.cpp` | 733 | Main overlay, ImGui rendering, input handling |
| `audiohook.cpp` | 1,214 | Wwise function hooks, event logging |
| `audiohook.h` | 135 | AudioHook namespace API |
| `event_mapping.h` | 2,817+ | Auto-generated event ID → name mapping |
| `hash_dictionary.h` | 153 | FNV-1 implementation, switch group constants |
| `d3d9hook.cpp` | ~300 | DirectX 9 EndScene hook |
| `debugrenderer.cpp` | ~400 | Text/primitive rendering |

### Hook Implementation

**Technique**: 5-byte JMP hook (0xE9 + 4-byte relative offset)

```cpp
// Hook installation pattern
void InstallHook(DWORD targetAddr, DWORD hookFunc) {
    DWORD oldProtect;
    VirtualProtect((void*)targetAddr, 5, PAGE_EXECUTE_READWRITE, &oldProtect);

    // Save original bytes for trampoline
    memcpy(g_OriginalBytes, (void*)targetAddr, 5);

    // Write JMP instruction
    *(BYTE*)targetAddr = 0xE9;
    *(DWORD*)(targetAddr + 1) = hookFunc - targetAddr - 5;

    VirtualProtect((void*)targetAddr, 5, oldProtect, &oldProtect);
}
```

### Hooked Functions

#### PostEventByID (0x00561360)

```cpp
DWORD __cdecl HookedPostEvent(DWORD eventId, DWORD gameObjId) {
    // Log event with timestamp
    AudioEvent evt;
    evt.timestamp = GetTickCount();
    evt.eventId = eventId;
    evt.gameObjId = gameObjId;
    evt.eventName = LookupEventName(eventId);
    evt.bankName = LookupBankName(eventId);

    g_EventLog.push_back(evt);

    // Call original
    return OriginalPostEvent(eventId, gameObjId);
}
```

#### GetIDFromString (0x00560190)

```cpp
DWORD __cdecl HookedGetIDFromString(const char* str) {
    DWORD hash = OriginalGetIDFromString(str);

    // Capture bank name hashes
    if (str && strlen(str) > 0) {
        g_CapturedNames[hash] = str;
        LogToFile("0x%08x -> %s", hash, str);
    }

    return hash;
}
```

### Event Mapping Pipeline

**Generator**: `wwiseRE/parse_txtp.py`

**Data flow**:
```
BNK files (extracted/*.bnk)
    ↓ parse_bnk()
HIRC CAkEvent IDs + Bank names
    ↓
TXTP files (txtp/*.txtp)
    ↓ parse_txtp_file()
Event ID → "BankName-NNNN" mapping
    ↓
overrides.csv (manual FNV-cracked names)
    ↓ merge_mappings()
event_mapping.h (C++ header)
```

**Output structure**:
```cpp
struct EventMappingEntry {
    DWORD id;           // FNV-1 hash
    const char* bank;   // Source bank name
    const char* name;   // Event name (nullptr if unknown)
};

static const EventMappingEntry g_EventMappingData[] = {
    {0x4588BDDC, "BaseCombat", "play_ability"},
    {0xA5D460EA, "BaseCombat", "stop_ability"},
    {0xAE7FDABB, "HeroSauron", nullptr},  // Unknown
    // ... 2,817 entries
};
```

### Audio Panel Features

**Toggle**: F7 key

**Display**:
- Real-time event log (last 50 events)
- Event filtering (hide footsteps, noisy events)
- Bank tracking (permanent list of loaded banks)
- Switch/State change tracking
- Playback controls (Play, Stop, StopAll)

**Color coding**:

- Gold: Hero combat events `[HERO]`
- Cyan: Voice/chatter events `[VOICE]`
- White: General events
- Gray: Filtered/noisy events

---

## Data Sources and Extraction

### File Inventory

| Source | Location | Count | Description |
|--------|----------|-------|-------------|
| BNK files | `wwiseRE/extracted/` | 53 | Wwise soundbanks |
| TXTP files | `wwiseRE/txtp/` | 2,900 | Event playback definitions |
| WEM files | `wwiseRE/wem/` | 411 | Encoded audio files |
| Level JSONs | `LUA/shell/sub_blocks2/` | 13 | Level definitions with VO events |
| Overrides | `wwiseRE/overrides.csv` | 1,447 | FNV-cracked event names |

### Bank Distribution

From `extracted_events.json`:

| Category | Banks | Events |
|----------|-------|--------|
| Hero SFX | 13 | 64 |
| Hero Chatter | 20 | 480 |
| Creature SFX | 8 | 90 |
| Level Ambience | 13 | 234 |
| Level VO | 13 | 1,086 |
| Base Combat | 1 | 41 |
| Effects | 1 | 53 |
| Music | 1 | 59 |
| UI | 1 | 17 |
| **Total** | **71** | **2,817** |

### Key Banks

| Bank Name | Hash | Events | Description |
|-----------|------|--------|-------------|
| HeroSauron | 0xAE7FDABB | 13 | Sauron combat SFX |
| ChatterHeroSauron | 0x024F9CA2 | 24 | Sauron voice lines |
| HeroAragorn | 0xD210FF9B | 2 | Aragorn combat SFX |
| ChatterHeroAragorn | 0x33EFEBB8 | 24 | Aragorn voice lines |
| BaseCombat | - | 41 | Generic combat events |
| Creatures | - | 15 | Generic creature sounds |

### BaseCombat Event Semantics

Discovered through runtime correlation:

| Event Index | Hash | Semantic | Description |
|-------------|------|----------|-------------|
| 0707 | - | swing | Weapon swing sound |
| 0709 | - | ability | Ability activation |
| 0722 | - | impact | Hit impact sound |
| 0724 | - | impact_kill | Kill impact sound |

These are generic events layered with hero-specific vocals via switch containers.

### Extraction Tools

| Tool | Purpose |
|------|---------|
| wwiser | BNK → TXTP/WEM extraction |
| vgmstream | WEM → WAV/OGG conversion |
| parse_txtp.py | TXTP → event_mapping.h generation |
| extract_events_from_xml.py | BNK XML → extracted_events.json |

---

## What Has Been Done vs. Not Done

###  Completed

1. **Wwise Version Identification**
   - Confirmed v34 (2008-2009)
   - Documented BNK/HIRC structure

2. **FNV-1 Hash Algorithm**
   - Reverse engineered from `GetIDFromString`
   - Implemented in C, Python, C++
   - Verified against known event names

3. **DebugOverlay DLL**
   - PostEvent hook with event logging
   - GetIDFromString hook for name capture
   - SetSwitch/SetState tracking
   - Real-time audio panel (F7)
   - Bank load tracking

4. **Event Mapping**
   - 2,817 events catalogued
   - 1,325 (47%) with semantic names
   - Automated pipeline (parse_txtp.py)

5. **Hash Cracking Infrastructure**
   - C brute forcer (~200M/s)
   - Python multicore cracker
   - CUDA GPU cracker
   - Dictionary attack framework

6. **Data Extraction**
   - 53 BNK files parsed
   - 2,900 TXTP files generated
   - 411 WEM files extracted
   - Level JSON VO events mined

###  In Progress

1. **8-Character Brute Force**
   - 12.4% complete
   - ETA: ~3.5 hours remaining

2. **Stubborn Event Cracking**
   - 18 priority events remaining
   - Pattern attacks ongoing

###  Not Done

1. **Audio Modding System**
   - Design complete
   - Implementation not started

2. **3D Audio Positioning**
   - SetPosition/SetListenerPosition hooks not implemented
   - Required for spatial audio replacement

3. **WEM Repacking**
   - No tool for creating Wwise v34 compatible WEM files
   - Would require finding 2008-era Wwise SDK

4. **Complete Event Name Recovery**
   - 53% of events still unnamed
   - May require longer brute force or additional data sources

---

## Audio Modding Feasibility

### Approach Comparison

| Approach | Complexity | 3D Audio | Pros | Cons |
|----------|------------|----------|------|------|
| WEM Replacement | Near Impossible |  Yes | Native Wwise playback | Requires repacking sound.pck |
| Hook Redirection | Medium |  2D only | No file modification | Custom audio plays flat |
| Hook + Position | Hard |  Yes | Full control | Complex implementation |

### Recommended: Simple Mod Folder System

**User experience**:
```
ConquestMods/
└── audio/
    ├── play_vo_trn_keepfighting_remind_02.ogg  ← Custom audio
    ├── sauron_attack_1.wav
    └── overrides.txt  ← Optional mapping
```

**Implementation**:

```cpp
// In HookedPostEvent:
std::string eventName = GetEventName(eventHash);
std::string modPath = "ConquestMods/audio/" + eventName;

if (FileExists(modPath + ".ogg") ||
    FileExists(modPath + ".mp3") ||
    FileExists(modPath + ".wav")) {
    PlayCustomAudio(modPath);  // Use miniaudio library
    return;  // Skip original Wwise event
}

// Otherwise, call original PostEvent
return OriginalPostEvent(eventId, gameObjId);
```

### Audio Library Options

| Library | Size | Formats | 3D Support |
|---------|------|---------|------------|
| miniaudio | Single .h | WAV, MP3, FLAC |  Yes |
| BASS | ~300KB DLL | Everything |  Yes |
| XAudio2 | Windows built-in | WAV, custom |  Yes (X3DAudio) |
| SDL_mixer | ~1MB | Everything |  No |

### 3D Audio Implementation

**Required hooks**:

```cpp
// Capture game object positions
void HookedSetPosition(DWORD gameObjId, float x, float y, float z, ...) {
    g_ObjectPositions[gameObjId] = {x, y, z};
    OriginalSetPosition(gameObjId, x, y, z, ...);
}

// Capture listener (camera) position
void HookedSetListenerPosition(float x, float y, float z, ...) {
    g_ListenerPos = {x, y, z};
    OriginalSetListenerPosition(x, y, z, ...);
}
```

**3D calculation**:

```cpp
void PlayCustomAudio3D(const char* path, DWORD gameObjId) {
    Vector3 objPos = g_ObjectPositions[gameObjId];
    Vector3 listenerPos = g_ListenerPos;

    float distance = Distance(objPos, listenerPos);
    float pan = CalculatePan(objPos, listenerPos);
    float volume = 1.0f / (1.0f + distance * 0.1f);  // Distance attenuation

    PlayAudioWithParams(path, volume, pan);
}
```

---

## Lessons Learned

### Technical Insights

1. **FNV-1 is case-insensitive in Wwise**
   - All strings lowercased before hashing
   - Critical for hash cracking accuracy

2. **Event names follow strict conventions**
   - `play_*`, `stop_*` prefixes common
   - `_sa1`, `_sa2`, `_sa3` for special abilities
   - `_a01`, `_a02` for numbered variants

3. **Level JSONs contain unhashed names**
   - `VOSoundEvents` arrays have plaintext
   - Game adds `play_` prefix at runtime

4. **Switch containers layer audio**
   - Generic events (BaseCombat) + hero-specific switches
   - Same event ID plays different audio based on switch state

5. **Bank loading is permanent**
   - Once loaded, banks stay in memory
   - No unload tracking needed

### Process Insights

1. **Dictionary attacks first**
   - Much faster than brute force
   - LOTR-specific wordlists essential

2. **Pattern discovery accelerates cracking**
   - Finding one `_sa1` event reveals `_sa2`, `_sa3`
   - Consecutive hashes often indicate numbered variants

3. **Runtime capture is most reliable**
   - Hooking `GetIDFromString` captures exact names
   - No guessing required

4. **Baby steps approach works**
   - Small incremental changes
   - Constant verification
   - Easier debugging

### What Would Be Done Differently

1. **Start with runtime capture**
   - Hook `GetIDFromString` first
   - Capture names during normal gameplay
   - Then fill gaps with brute force

2. **GPU acceleration earlier**
   - CUDA cracker 2.5x faster than CPU
   - Should have prioritized this

3. **Better documentation from start**
   - Session notes invaluable
   - Should have documented every discovery immediately

---

## Appendices

### Appendix A: Cracked Event Categories

From `overrides.csv` (1,447 entries):

| Category | Count | Examples |
|----------|-------|----------|
| SWITCH | 22 | creature, weapon, ability, material |
| CREATURE | 65 | balrog_attack, troll_death, warg_hit |
| HERO | 45 | gandalf_death, sauron_mace_attack, gimli_charge |
| COMBAT | 35 | attack_vocal, hit_vocal, sword_stab |
| EFFECT | 180 | footstep, cloak, bomb, cp_capture |
| UI | 12 | pause_game, ui_confirm, ui_cancel |
| VOICE | 850+ | vo_cks_01, play_vo_cq_conquest_v1 |
| AMBIENT | 120 | amb_battle, play_moria_good, shell_amb |

### Appendix B: Switch Groups and Values

**Decoded switch groups**:

| Group | Hash | Values |
|-------|------|--------|
| creature | 0x9EA3031A | orc, oliphaunt, human, troll, gandalf, mouthofsauron |
| weapon | 0xE810D505 | sword, staff, bow, daggers, punch, kick |
| ability | 0x485FC991 | (various ability types) |
| material | 0xE6640542 | stone, wood, dirt, metal_armor |
| player_controlled | 0x67053B33 | yes, no |

### Appendix C: Tool Performance Benchmarks

**Test system**: Intel i7-13620H, 48GB DDR5-5600, RTX 5070 Laptop

| Tool | Language | Hashes/sec | Notes |
|------|----------|------------|-------|
| brute_fnv1.exe | C (MSVC /O2) | 200M | Single-threaded |
| brute_fnv1.exe | C (GCC -O3) | 220M | Single-threaded |
| multicore_cracker.py | Python | 50M | 10 cores |
| brute_force_cuda.py | Python/CUDA | 500M | RTX 5070 |
| advanced_cracker.py | Python | 10M | Dictionary mode |

### Appendix D: Key Code Snippets

**FNV-1 Hash (C)**:

```c
#define FNV_OFFSET 2166136261u
#define FNV_PRIME 16777619u

uint32_t fnv1_hash(const char* s) {
    uint32_t h = FNV_OFFSET;
    while (*s) {
        char c = tolower(*s++);
        h = (h * FNV_PRIME) ^ (uint8_t)c;
    }
    return h;
}
```

**PostEvent Hook (C++)**:

```cpp
typedef DWORD(__cdecl* PostEventFn)(DWORD, DWORD);
PostEventFn OriginalPostEvent = nullptr;

DWORD __cdecl HookedPostEvent(DWORD eventId, DWORD gameObjId) {
    // Log event
    LogEvent(eventId, gameObjId);

    // Check for custom audio override
    if (HasCustomAudio(eventId)) {
        PlayCustomAudio(eventId, gameObjId);
        return 0;  // Skip original
    }

    return OriginalPostEvent(eventId, gameObjId);
}
```

**TXTP Parsing (Python)**:

```python
def parse_txtp_file(filepath):
    filename = filepath.name
    match = re.match(r'^([^-]+)-(\d+)-event', filename)
    if not match:
        return None

    bank_name = match.group(1)
    event_index = int(match.group(2))

    with open(filepath, 'r') as f:
        content = f.read()

    event_match = re.search(r'CAkEvent\[\d+\]\s+(\d+)', content)
    if not event_match:
        return None

    event_id = int(event_match.group(1))
    return event_id, f"{bank_name}-{event_index:04d}"
```

### Appendix E: File Structure

```
ConquestConsole/
├── DebugOverlay/
│   └── src/
│       ├── dllmain.cpp          # Main overlay
│       ├── audiohook.cpp        # Wwise hooks
│       ├── audiohook.h          # Hook API
│       ├── event_mapping.h      # Auto-generated
│       ├── hash_dictionary.h    # FNV-1 + constants
│       ├── d3d9hook.cpp         # D3D9 EndScene hook
│       └── debugrenderer.cpp    # Rendering
│
├── wwiseRE/
│   ├── extracted/               # 53 BNK files
│   ├── txtp/                    # 2,900 TXTP files
│   ├── wem/                     # 411 WEM files
│   ├── HashCracking/            # 22 cracking tools
│   │   ├── brute_fnv1.c
│   │   ├── multicore_cracker.py
│   │   ├── brute_force_cuda.py
│   │   └── ...
│   ├── overrides.csv            # 1,447 cracked names
│   ├── extracted_events.json    # Event catalog
│   └── parse_txtp.py            # Header generator
│
├── LUA/shell/sub_blocks2/       # Level JSONs
│   ├── Training/level.json
│   ├── Moria/level.json
│   └── ...
│
└── captured_audio_names.txt     # Runtime captures
```

### Appendix F: References

1. **Wwise SDK Documentation** (2008 era) - Not publicly available
2. **wwiser** - https://github.com/bnnm/wwiser
3. **vgmstream** - https://github.com/vgmstream/vgmstream
4. **FNV Hash** - http://www.isthe.com/chongo/tech/comp/fnv/
5. **MinHook** - https://github.com/TsudaKageworthy/minhook

---

*Document generated: 2025-12-09*
*Last updated: 2025-12-09*
*Author: Eriumsss*
